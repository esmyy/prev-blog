"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[2653],{3905:(e,t,r)=>{r.d(t,{Zo:()=>p,kt:()=>h});var n=r(7294);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function u(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var a=n.createContext({}),l=function(e){var t=n.useContext(a),r=t;return e&&(r="function"==typeof e?e(t):s(s({},t),e)),r},p=function(e){var t=l(e.components);return n.createElement(a.Provider,{value:t},e.children)},c="mdxType",f={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var r=e.components,o=e.mdxType,i=e.originalType,a=e.parentName,p=u(e,["components","mdxType","originalType","parentName"]),c=l(r),m=o,h=c["".concat(a,".").concat(m)]||c[m]||f[m]||i;return r?n.createElement(h,s(s({ref:t},p),{},{components:r})):n.createElement(h,s({ref:t},p))}));function h(e,t){var r=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=r.length,s=new Array(i);s[0]=m;var u={};for(var a in t)hasOwnProperty.call(t,a)&&(u[a]=t[a]);u.originalType=e,u[c]="string"==typeof e?e:o,s[1]=u;for(var l=2;l<i;l++)s[l]=r[l];return n.createElement.apply(null,s)}return n.createElement.apply(null,r)}m.displayName="MDXCreateElement"},6799:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>a,contentTitle:()=>s,default:()=>f,frontMatter:()=>i,metadata:()=>u,toc:()=>l});var n=r(7462),o=(r(7294),r(3905));const i={},s="install",u={unversionedId:"frameworks/vue2/vue-router/install",id:"frameworks/vue2/vue-router/install",title:"install",description:"Vue Router \u4f5c\u4e3a\u4e00\u4e2a\u63d2\u4ef6\u5b89\u88c5\uff0c\u4ee5\u6dfb\u52a0\u5185\u7f6e\u8def\u7531\u7ec4\u4ef6\uff0c\u5728\u6bcf\u4e2a Vue \u7ec4\u4ef6\u5b9e\u4f8b\u4e0a\u6dfb\u52a0 VueRouter \u5b9e\u4f8b\u7684\u5f15\u7528\u3002",source:"@site/docs/05-frameworks/02-vue2/05-vue-router/02-install.md",sourceDirName:"05-frameworks/02-vue2/05-vue-router",slug:"/frameworks/vue2/vue-router/install",permalink:"/docs/frameworks/vue2/vue-router/install",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/05-frameworks/02-vue2/05-vue-router/02-install.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{},sidebar:"vue2",previous:{title:"\u4ecb\u7ecd",permalink:"/docs/frameworks/vue2/vue-router/intro"},next:{title:"\u4e09\u4e2a\u6a21\u5757",permalink:"/docs/frameworks/vue2/vue-router/main"}},a={},l=[{value:"mixin",id:"mixin",level:2},{value:"init",id:"init",level:2},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2}],p={toc:l},c="wrapper";function f(e){let{components:t,...i}=e;return(0,o.kt)(c,(0,n.Z)({},p,i,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"install"},"install"),(0,o.kt)("p",null,"Vue Router \u4f5c\u4e3a\u4e00\u4e2a\u63d2\u4ef6\u5b89\u88c5\uff0c\u4ee5\u6dfb\u52a0\u5185\u7f6e\u8def\u7531\u7ec4\u4ef6\uff0c\u5728\u6bcf\u4e2a Vue \u7ec4\u4ef6\u5b9e\u4f8b\u4e0a\u6dfb\u52a0 VueRouter \u5b9e\u4f8b\u7684\u5f15\u7528\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'import View from "./components/view";\nimport Link from "./components/link";\n\nexport let _Vue;\n\nexport function install(Vue) {\n  if (install.installed && _Vue === Vue) return;\n  install.installed = true;\n\n  _Vue = Vue;\n\n  const isDef = (v) => v !== undefined;\n\n  const registerInstance = (vm, callVal) => {\n    let i = vm.$options._parentVnode;\n    if (\n      isDef(i) &&\n      isDef((i = i.data)) &&\n      isDef((i = i.registerRouteInstance))\n    ) {\n      i(vm, callVal);\n    }\n  };\n\n  Vue.mixin({\n    beforeCreate() {\n      if (isDef(this.$options.router)) {\n        this._routerRoot = this;\n        this._router = this.$options.router;\n        this._router.init(this);\n        Vue.util.defineReactive(this, "_route", this._router.history.current);\n      } else {\n        this._routerRoot = (this.$parent && this.$parent._routerRoot) || this;\n      }\n      registerInstance(this, this);\n    },\n    destroyed() {\n      registerInstance(this);\n    },\n  });\n\n  Object.defineProperty(Vue.prototype, "$router", {\n    get() {\n      return this._routerRoot._router;\n    },\n  });\n\n  Object.defineProperty(Vue.prototype, "$route", {\n    get() {\n      return this._routerRoot._route;\n    },\n  });\n\n  Vue.component("RouterView", View);\n  Vue.component("RouterLink", Link);\n\n  const strats = Vue.config.optionMergeStrategies;\n  // use the same hook merging strategy for route hooks\n  strats.beforeRouteEnter =\n    strats.beforeRouteLeave =\n    strats.beforeRouteUpdate =\n      strats.created;\n}\n')),(0,o.kt)("p",null,"\u9996\u5148\u662f\u4e00\u4e2a\u9632\u91cd\u590d\u6ce8\u518c\u68c0\u67e5\uff0c\u7136\u540e Vue.mixin \u6ce8\u518c\u4e86\u4e00\u4e2a\u5168\u5c40\u7684 mixin\uff0c\u5b9a\u4e49\u4e86$router\u548c$route \u5c5e\u6027\uff0c\u6ce8\u518c\u4e86 RouterView \u548c RouterLink \u4e24\u4e2a\u7ec4\u4ef6\u3002"),(0,o.kt)("p",null,"\u8fd9\u91cc\u901a\u8fc7$parent\u53bb\u8bbe\u7f6e\u6bcf\u4e2a vm \u5bf9 rootVm \u7684\u8bbf\u95ee\uff0c\u5b9a\u4e49\u901a\u8fc7$router \u548c$route \u90fd\u662f\u4ee3\u7406\u5230 ","_","routerRoot\uff0c\u5176\u5b9e\u90fd\u53ea\u662f\u4e3a\u4e86\u652f\u6301 router \u5d4c\u5957\u7684\u573a\u666f\u3002"),(0,o.kt)("h2",{id:"mixin"},"mixin"),(0,o.kt)("p",null,"\u5728 beforeCreate \u6dfb\u52a0\u5bf9 router \u5b9e\u4f8b\u7684\u5f15\u7528\u3002\u5982\u679c\u4f20\u9012\u4e86 router \u5b9e\u4f8b(\u6211\u4eec new Vue \u6839\u5b9e\u4f8b\u521d\u59cb\u5316\uff0c\u79f0\u4e3a rootVm)\uff0c\u901a\u8fc7","_","routerRoot \u5c5e\u6027\u5f15\u7528 rootVm\uff0c\u901a\u8fc7","_","router \u5f15\u7528 router\uff0c\u800c\u5bf9\u4e8e\u5176\u4ed6\u7684\u7ec4\u4ef6\u5b9e\u4f8b\uff0c\u5219\u901a\u8fc7$parent \u83b7\u53d6\u5230 rootVm \u7684\u5f15\u7528\u3002"),(0,o.kt)("h2",{id:"init"},"init"),(0,o.kt)("p",null,"\u5728 rootVm \u7684 beforeCreate \u4e2d\u8c03\u7528\u4e86 router \u5b9e\u4f8b\u7684 init \u65b9\u6cd5\uff0c\u5176\u5982\u4e0b"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"init (app: any /* Vue component instance */) {\n  process.env.NODE_ENV !== 'production' &&\n    assert(\n      install.installed,\n      `not installed. Make sure to call \\`Vue.use(VueRouter)\\` ` +\n        `before creating root instance.`\n    )\n\n  this.apps.push(app)\n\n  // set up app destroyed handler\n  // https://github.com/vuejs/vue-router/issues/2639\n  app.$once('hook:destroyed', () => {\n    // clean out app from this.apps array once destroyed\n    const index = this.apps.indexOf(app)\n    if (index > -1) this.apps.splice(index, 1)\n    // ensure we still have a main app or null if no apps\n    // we do not release the router so it can be reused\n    if (this.app === app) this.app = this.apps[0] || null\n\n    if (!this.app) this.history.teardown()\n  })\n\n  // main app previously initialized\n  // return as we don't need to set up new history listener\n  if (this.app) {\n    return\n  }\n\n  this.app = app\n\n  const history = this.history\n\n  if (history instanceof HTML5History || history instanceof HashHistory) {\n    const handleInitialScroll = routeOrError => {\n      const from = history.current\n      const expectScroll = this.options.scrollBehavior\n      const supportsScroll = supportsPushState && expectScroll\n\n      if (supportsScroll && 'fullPath' in routeOrError) {\n        handleScroll(this, routeOrError, from, false)\n      }\n    }\n    const setupListeners = routeOrError => {\n      history.setupListeners()\n      handleInitialScroll(routeOrError)\n    }\n    history.transitionTo(\n      history.getCurrentLocation(),\n      setupListeners,\n      setupListeners\n    )\n  }\n\n  history.listen(route => {\n    this.apps.forEach(app => {\n      app._route = route\n    })\n  })\n}\n")),(0,o.kt)("p",null,"\u5173\u4e8e app \u7684\u90e8\u5206\u662f\u4e0e VueRouter \u5b9e\u4f8b\u5d4c\u5957\u6709\u5173\u7684\u5904\u7406\uff0c\u5728\u672c\u7cfb\u5217\u6587\u7ae0\u4e2d\u4e3b\u8981\u7814\u7a76 \u5355\u4e2a VueRouter \u5b9e\u4f8b\u7684\u60c5\u51b5\uff0c\u4e0d\u5bf9 app \u76f8\u5173\u7684\u505a\u6df1\u5165\u7814\u7a76\u3002\u7136\u540e\u5176\u4ed6\u7684\u662f\u548c history \u76f8\u5173\u7684\u8bbe\u7f6e\uff0c\u8c03\u7528\u4e86 history.transitionTo \u548c history.listen\uff0c\u8fd9\u4e2a\u5728 history \u90e8\u5206\u52a0\u4ee5\u8bf4\u660e\u3002"),(0,o.kt)("h2",{id:"\u603b\u7ed3"},"\u603b\u7ed3"),(0,o.kt)("p",null,"VueRouter \u7684\u4e24\u4e2a\u6838\u5fc3\u5185\u5bb9\u662f matcher \u548c history\u3002install \u8fc7\u7a0b\u4e2d\u8bbe\u7f6e\u7684\u5404\u5f15\u7528\u4e4b\u95f4\u7684\u5173\u7cfb\u5982\u4e0b"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"vue router",src:r(5711).Z,width:"979",height:"479"})),(0,o.kt)("p",null,"$router \u548c $route \u90fd\u662f\u8bbe\u7f6e\u4e86 getter \u51fd\u6570\u7684\u5f15\u7528\uff0c\u662f\u6307\u5411\u7684 rootVm \u4e0a\u5bf9\u5e94\u7684\u5c5e\u6027\uff0c\u5f53\u6709\u591a\u4e2a VueRouter \u5b9e\u4f8b\u7684\u65f6\u5019\uff0c\u4e0d\u540c vm \u7684 $router \u548c $route \u6307\u5411\u7684\u4e0d\u4e00\u5b9a\u662f\u540c\u4e00\u4e2a\u5bf9\u8c61\u3002"))}f.isMDXComponent=!0},5711:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/vue-router-16802609fd59d6fae0cf4b982de5c54d.jpg"}}]);