"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[8338],{3905:(e,t,n)=>{n.d(t,{Zo:()=>s,kt:()=>h});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function u(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var i=r.createContext({}),l=function(e){var t=r.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},s=function(e){var t=l(e.components);return r.createElement(i.Provider,{value:t},e.children)},p="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,i=e.parentName,s=u(e,["components","mdxType","originalType","parentName"]),p=l(n),d=a,h=p["".concat(i,".").concat(d)]||p[d]||m[d]||o;return n?r.createElement(h,c(c({ref:t},s),{},{components:n})):r.createElement(h,c({ref:t},s))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,c=new Array(o);c[0]=d;var u={};for(var i in t)hasOwnProperty.call(t,i)&&(u[i]=t[i]);u.originalType=e,u[p]="string"==typeof e?e:a,c[1]=u;for(var l=2;l<o;l++)c[l]=n[l];return r.createElement.apply(null,c)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},9819:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>c,default:()=>m,frontMatter:()=>o,metadata:()=>u,toc:()=>l});var r=n(7462),a=(n(7294),n(3905));const o={},c="match",u={unversionedId:"frameworks/vue2/vue-router/match",id:"frameworks/vue2/vue-router/match",title:"match",description:"\u5b9a\u4e49\u5728 src/create-matcher.js",source:"@site/docs/05-frameworks/02-vue2/05-vue-router/06-match.md",sourceDirName:"05-frameworks/02-vue2/05-vue-router",slug:"/frameworks/vue2/vue-router/match",permalink:"/docs/frameworks/vue2/vue-router/match",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/05-frameworks/02-vue2/05-vue-router/06-match.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{},sidebar:"vue2",previous:{title:"\u8def\u7531\u5207\u6362",permalink:"/docs/frameworks/vue2/vue-router/transition"},next:{title:"install",permalink:"/docs/frameworks/vue2/vuex/install"}},i={},l=[{value:"normalizeLocation",id:"normalizelocation",level:2},{value:"matchRoute",id:"matchroute",level:2},{value:"createRoute",id:"createroute",level:2},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2}],s={toc:l},p="wrapper";function m(e){let{components:t,...n}=e;return(0,a.kt)(p,(0,r.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"match"},"match"),(0,a.kt)("p",null,"\u5b9a\u4e49\u5728 src/create-matcher.js"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'function match(\n  raw: RawLocation,\n  currentRoute?: Route,\n  redirectedFrom?: Location\n): Route {\n  const location = normalizeLocation(raw, currentRoute, false, router);\n  const { name } = location;\n\n  if (name) {\n    const record = nameMap[name];\n    if (process.env.NODE_ENV !== "production") {\n      warn(record, `Route with name \'${name}\' does not exist`);\n    }\n\n    // \u4f7f\u7528 `name` \u8df3\u8f6c\uff0c\u4f46\u662f\u5b9e\u9645\u4e0a\u5728\u914d\u7f6e\u7684 routes \u4e2d\u5e76\u6ca1\u6709\u5bf9\u5e94\u7684\u914d\u7f6e\n    if (!record) return _createRoute(null, location);\n\n    // \u63d0\u53d6 path \u4e2d\u7684\u53c2\u6570\uff0c\u5982\u5bf9\u4e8e \'/bar/:id\'\uff0c\u8fd9\u91cc\u8fd4\u56de\u662f [\'id\']\n    const paramNames = record.regex.keys\n      .filter((key) => !key.optional)\n      .map((key) => key.name);\n\n    if (typeof location.params !== "object") {\n      location.params = {};\n    }\n\n    // \u901a\u8fc7name\u8df3\u8f6c\u65f6\uff0c\u53c2\u6570\u4f1a\u540c\u6b65\uff0c\u6bd4\u5982\u8bf4/foo/:id \u5230 /bar/:id\uff0c\u6307\u5b9a\n    if (currentRoute && typeof currentRoute.params === "object") {\n      for (const key in currentRoute.params) {\n        if (!(key in location.params) && paramNames.indexOf(key) > -1) {\n          location.params[key] = currentRoute.params[key];\n        }\n      }\n    }\n\n    location.path = fillParams(\n      record.path,\n      location.params,\n      `named route "${name}"`\n    );\n    return _createRoute(record, location, redirectedFrom);\n  } else if (location.path) {\n    location.params = {};\n    for (let i = 0; i < pathList.length; i++) {\n      const path = pathList[i];\n      const record = pathMap[path];\n      if (matchRoute(record.regex, location.path, location.params)) {\n        return _createRoute(record, location, redirectedFrom);\n      }\n    }\n  }\n  // no match\n  return _createRoute(null, location);\n}\n')),(0,a.kt)("p",null,"raw \u5c31\u662f\u6211\u4eec\u4f7f\u7528 router.push \u65f6\u4f20\u9012\u7684\u53c2\u6570\uff0c\u6807\u51c6\u5316\u5f97\u5230 location \u5bf9\u8c61\u4e4b\u540e\uff0c\u5c31\u6839\u636e location \u7684 name \u548c path\uff0c\u4ece nameMap \u6216\u8005 pathMap \u4e2d\u627e\u5230\u5bf9\u5e94\u7684 record(RouteRecord \u5bf9\u8c61)\uff0c\u7136\u540e\u6839\u636e record \u8c03\u7528","_","createRoute \u53bb\u751f\u6210\u65b0\u7684 route\u3002"),(0,a.kt)("p",null,"\u4e3b\u8981\u5173\u6ce8\u8fd9\u51e0\u4e2a\u65b9\u9762\u7684\u5185\u5bb9:"),(0,a.kt)("p",null,"normalizeLocation"),(0,a.kt)("p",null,"matchRoute"),(0,a.kt)("p",null,"createRoute"),(0,a.kt)("h2",{id:"normalizelocation"},"normalizeLocation"),(0,a.kt)("p",null,"normalizeLocation \u662f\u5c06 RawLocation \u7c7b\u578b\u7684\u53c2\u6570\u6807\u51c6\u5316\u4e3a\u4e00\u4e2a Location \u7c7b\u578b\u7684\u7ed3\u679c\uff0c\u662f\u4e00\u4e2a\u7528\u6237\u8f93\u5165\u5904\u7406\u7684\u8fc7\u7a0b\uff0c\u4ee3\u7801\u5982\u4e0b"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'export function normalizeLocation(\n  raw: RawLocation,\n  current: ?Route,\n  append: ?boolean,\n  router: ?VueRouter\n): Location {\n  let next: Location = typeof raw === "string" ? { path: raw } : raw;\n\n  // named target\n  // \u4f7f\u7528\u8def\u7531\u540d\u79f0\u8df3\u8f6c\u65f6\u7684\u5904\u7406\n  if (next._normalized) {\n    return next;\n  } else if (next.name) {\n    next = extend({}, raw);\n    const params = next.params;\n    if (params && typeof params === "object") {\n      next.params = extend({}, params);\n    }\n    return next;\n  }\n\n  // relative params\n  // \u76f8\u5bf9\u53c2\u6570\u8df3\u8f6c\uff0c\u6bd4\u5982\u8bf4\u5bf9\u4e8e/bar/:id\u7684\u4ece/bar/1\u8df3\u8f6c\u5230/bar/2\n  if (!next.path && next.params && current) {\n    next = extend({}, next);\n    next._normalized = true;\n    const params: any = extend(extend({}, current.params), next.params);\n    if (current.name) {\n      next.name = current.name;\n      next.params = params;\n    } else if (current.matched.length) {\n      const rawPath = current.matched[current.matched.length - 1].path;\n      next.path = fillParams(rawPath, params, `path ${current.path}`);\n    } else if (process.env.NODE_ENV !== "production") {\n      warn(false, `relative params navigation requires a current route.`);\n    }\n    return next;\n  }\n\n  // \u5904\u7406 path\n  const parsedPath = parsePath(next.path || "");\n  const basePath = (current && current.path) || "/";\n  const path = parsedPath.path\n    ? resolvePath(parsedPath.path, basePath, append || next.append)\n    : basePath;\n\n  // \u5904\u7406 query\n  const query = resolveQuery(\n    parsedPath.query,\n    next.query,\n    router && router.options.parseQuery\n  );\n\n  // \u5904\u7406 hash\n  let hash = next.hash || parsedPath.hash;\n  if (hash && hash.charAt(0) !== "#") {\n    hash = `#${hash}`;\n  }\n\n  return {\n    _normalized: true,\n    path,\n    query,\n    hash,\n  };\n}\n')),(0,a.kt)("p",null,"\u8fd9\u4e2a raw\uff0c\u7406\u89e3\u4e3a\u8c03\u7528 push(location)\u7b49\u65b9\u6cd5\u4f20\u9012\u7684\u53c2\u6570\u5373\u53ef\uff0c\u6839\u636e\u4f7f\u7528\uff0c\u6211\u4eec\u77e5\u9053\u8fd9\u4e2a\u53ef\u80fd\u6709\u591a\u79cd\u60c5\u51b5\uff0c\u800c\u4e14 Vue Router \u652f\u6301\u6839\u636e name \u8fdb\u884c\u8df3\u8f6c\uff0cnormalizeLocation \u5c31\u662f\u7ed3\u5408 current \uff0c\u5bf9 location \u8fd9\u4e2a\u53c2\u6570\u505a\u4e00\u4e2a\u6807\u51c6\u5316\uff0c\u8bbe\u7f6e name, path, query \u548c hash \u7b49\u5404\u90e8\u5206\u7ec4\u6210\u3002"),(0,a.kt)("h2",{id:"matchroute"},"matchRoute"),(0,a.kt)("p",null,"\u5173\u6ce8\u4e0b\u9762\u6839\u636e path \u8fdb\u884c\u8def\u7531\u5339\u914d\u7684\u8fc7\u7a0b"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"function match(\n  raw: RawLocation,\n  currentRoute?: Route,\n  redirectedFrom?: Location\n): Route {\n  const location = normalizeLocation(raw, currentRoute, false, router);\n  const { name } = location;\n\n  if (name) {\n    // ...\n  } else if (location.path) {\n    location.params = {};\n    for (let i = 0; i < pathList.length; i++) {\n      const path = pathList[i];\n      const record = pathMap[path];\n      if (matchRoute(record.regex, location.path, location.params)) {\n        return _createRoute(record, location, redirectedFrom);\n      }\n    }\n  }\n}\n")),(0,a.kt)("p",null,"\u5047\u8bbe\u6211\u4eec\u662f\u8fd9\u6837\u8c03\u7528"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'this.$router.push({\n  path: "/foo",\n});\n')),(0,a.kt)("p",null,"\u90a3\u4e48\u5c31\u662f\u8981\u5728 pathMap \u91cc\u9762\uff0c\u627e\u5230\u548c /foo \u8fd9\u4e2a\u8def\u7531\u5339\u914d\u7684\u8bb0\u5f55\uff0c\u5339\u914d\u7684\u65b9\u6cd5 matchRoute \u5982\u4e0b"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'function matchRoute(regex: RouteRegExp, path: string, params: Object): boolean {\n  const m = path.match(regex);\n\n  if (!m) {\n    return false;\n  } else if (!params) {\n    return true;\n  }\n\n  for (let i = 1, len = m.length; i < len; ++i) {\n    const key = regex.keys[i - 1];\n    if (key) {\n      // Fix #1994: using * with props: true generates a param named 0\n      params[key.name || "pathMatch"] =\n        typeof m[i] === "string" ? decode(m[i]) : m[i];\n    }\n  }\n\n  return true;\n}\n')),(0,a.kt)("p",null,"\u8fd9\u91cc\u5176\u5b9e\u6838\u5fc3\u662f\u4e24\u4ef6\u4e8b\u60c5\uff0c\u4e00\u4e2a\u662f \u901a\u8fc7 reocrd.regex \u5224\u65ad\u662f\u5426\u5339\u914d\uff0c\u53e6\u4e00\u4e2a\u662f\u5bf9 params \u8fdb\u884c\u5904\u7406\uff0c\u6bd4\u5982\u8bf4/bar/:id \u8fd9\u6837\u7684\u8def\u7531\u91cc\u9762\uff0cid \u52a8\u6001\u53c2\u6570\u7684\u8bbe\u7f6e\u3002"),(0,a.kt)("h2",{id:"createroute"},"createRoute"),(0,a.kt)("p",null,"\u5b9a\u4e49\u5728 src/create-matcher.js"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"import { createRoute } from './util/route'\n\nfunction _createRoute (\n  record: ?RouteRecord,\n  location: Location,\n  redirectedFrom?: Location\n): Route {\n  if (record && record.redirect) {\n    return redirect(record, redirectedFrom || location)\n  }\n  if (record && record.matchAs) {\n    return alias(record, location, record.matchAs)\n  }\n  return createRoute(record, location, redirectedFrom, router)\n}\n\u8fd9\u4e2a\u51fd\u6570\u7684\u6700\u7ec8\u76ee\u7684\uff0c\u5c31\u662f\u8981\u8c03\u7528 createRoute \u6765\u521b\u5efa\u65b0\u7684 route\uff0ccreateRoute \u51fd\u6570\u5728 src/util/route.js\n\nexport function createRoute (\n  record: ?RouteRecord,\n  location: Location,\n  redirectedFrom?: ?Location,\n  router?: VueRouter\n): Route {\n  const stringifyQuery = router && router.options.stringifyQuery\n\n  let query: any = location.query || {}\n  try {\n    query = clone(query)\n  } catch (e) {}\n\n  const route: Route = {\n    name: location.name || (record && record.name),\n    meta: (record && record.meta) || {},\n    path: location.path || '/',\n    hash: location.hash || '',\n    query,\n    params: location.params || {},\n    fullPath: getFullPath(location, stringifyQuery),\n    matched: record ? formatMatch(record) : []\n  }\n  if (redirectedFrom) {\n    route.redirectedFrom = getFullPath(redirectedFrom, stringifyQuery)\n  }\n  return Object.freeze(route)\n}\n")),(0,a.kt)("p",null,"\u5c31\u662f\u6839\u636e location \u548c record \u521b\u5efa\u65b0\u7684 route\uff0c\u5bf9\u4e8e redirect \u548c alias \u7684\u573a\u666f\uff0c\u5355\u72ec\u8fdb\u884c\u4e86\u5904\u7406\u3002\u8fd9\u91cc\u9700\u8981\u7279\u522b\u5173\u6ce8\u7684\u662f matched \u5c5e\u6027\uff0c\u5b83\u901a\u8fc7 formatMatch \u51fd\u6570\u751f\u6210"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"function formatMatch(record: ?RouteRecord): Array<RouteRecord> {\n  const res = [];\n  while (record) {\n    res.unshift(record);\n    record = record.parent;\n  }\n  return res;\n}\n")),(0,a.kt)("p",null,"\u4e5f\u5c31\u662f\u8bf4\uff0cmatched \u4fdd\u5b58\u7684\u662f\u5339\u914d\u7684 record \u8bb0\u5f55\uff0c\u800c\u4e14\u662f\u6240\u6709\u76f8\u5173\u7684\u5404\u7ea7\u8def\u7531\u7684 record\u3002 \u8fd9\u91cc\u5c24\u5176\u9700\u8981\u5173\u6ce8\u7684\u662f\uff0cmatched \u6570\u7ec4\u4e2d\u5143\u7d20\u7684\u987a\u5e8f\u5173\u7cfb\uff0c\u662f\u5148\u7236\u540e\u5b50\u3002"),(0,a.kt)("h2",{id:"\u603b\u7ed3"},"\u603b\u7ed3"),(0,a.kt)("p",null,"\u6211\u4eec\u5728\u8c03\u7528 router.push(location)\u7b49\u51fd\u6570\u65f6\u4f20\u9012\u7684\u53c2\u6570\uff0c\u5b83\u662f\u4e00\u4e2a\u9875\u9762\u8def\u5f84\uff0c\u6216\u8005\u662f\u4e00\u4e2a\u7ea6\u5b9a\u7684 Location \u7c7b\u578b\u5bf9\u8c61\uff0cmatch \u51fd\u6570\u5c31\u662f\u6839\u636e\u8fd9\u4e2a\u53c2\u6570\uff0c\u5728 nameMap \u6216\u8005 pathMap \u4e2d\u627e\u5230\u5bf9\u5e94\u7684 record \u8def\u7531\u914d\u7f6e\u63cf\u8ff0\uff0c\u6839\u636e record \u53bb\u751f\u6210\u65b0\u7684 route \u5bf9\u8c61\uff0c\u7136\u540e\u5c06 route \u8fd4\u56de\u3002"))}m.isMDXComponent=!0}}]);