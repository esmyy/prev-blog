"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[2744],{3905:(e,n,t)=>{t.d(n,{Zo:()=>p,kt:()=>f});var o=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,o,r=function(e,n){if(null==e)return{};var t,o,r={},l=Object.keys(e);for(o=0;o<l.length;o++)t=l[o],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)t=l[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var m=o.createContext({}),u=function(e){var n=o.useContext(m),t=n;return e&&(t="function"==typeof e?e(n):a(a({},n),e)),t},p=function(e){var n=u(e.components);return o.createElement(m.Provider,{value:n},e.children)},c="mdxType",s={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},d=o.forwardRef((function(e,n){var t=e.components,r=e.mdxType,l=e.originalType,m=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),c=u(t),d=r,f=c["".concat(m,".").concat(d)]||c[d]||s[d]||l;return t?o.createElement(f,a(a({ref:n},p),{},{components:t})):o.createElement(f,a({ref:n},p))}));function f(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var l=t.length,a=new Array(l);a[0]=d;var i={};for(var m in n)hasOwnProperty.call(n,m)&&(i[m]=n[m]);i.originalType=e,i[c]="string"==typeof e?e:r,a[1]=i;for(var u=2;u<l;u++)a[u]=t[u];return o.createElement.apply(null,a)}return o.createElement.apply(null,t)}d.displayName="MDXCreateElement"},574:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>m,contentTitle:()=>a,default:()=>s,frontMatter:()=>l,metadata:()=>i,toc:()=>u});var o=t(7462),r=(t(7294),t(3905));const l={},a="mount",i={unversionedId:"frameworks/vue2/overview/mount",id:"frameworks/vue2/overview/mount",title:"mount",description:"created \u662f\u5b9e\u4f8b\u521b\u5efa\u5b8c\u6210\uff0c\u521b\u5efa\u5b8c\u6210\u4e4b\u540e\u5c31\u5230\u4e86\u4f7f\u7528\uff0c\u4e5f\u5c31\u662f mount \u7684\u8fc7\u7a0b\u3002",source:"@site/docs/05-frameworks/02-vue2/01-overview/06-mount.md",sourceDirName:"05-frameworks/02-vue2/01-overview",slug:"/frameworks/vue2/overview/mount",permalink:"/docs/frameworks/vue2/overview/mount",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/05-frameworks/02-vue2/01-overview/06-mount.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{},sidebar:"vue2",previous:{title:"new Vue",permalink:"/docs/frameworks/vue2/overview/new-vue"},next:{title:"compiler",permalink:"/docs/frameworks/vue2/compiler/compiler"}},m={},u=[{value:"\u524d\u7f6e",id:"\u524d\u7f6e",level:2},{value:"$mount",id:"mount-1",level:2},{value:"mountComponent",id:"mountcomponent",level:2},{value:"created -&gt; beforeMount",id:"created---beforemount",level:2},{value:"beforeMount -&gt; mounted",id:"beforemount---mounted",level:2},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2}],p={toc:u},c="wrapper";function s(e){let{components:n,...t}=e;return(0,r.kt)(c,(0,o.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"mount"},"mount"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"created")," \u662f\u5b9e\u4f8b\u521b\u5efa\u5b8c\u6210\uff0c\u521b\u5efa\u5b8c\u6210\u4e4b\u540e\u5c31\u5230\u4e86\u4f7f\u7528\uff0c\u4e5f\u5c31\u662f mount \u7684\u8fc7\u7a0b\u3002"),(0,r.kt)("h2",{id:"\u524d\u7f6e"},"\u524d\u7f6e"),(0,r.kt)("p",null,"\u5728","_","init \u51fd\u6570 created \u4e4b\u540e\uff0c\u6700\u540e\u4e00\u6b65\u662f\u8c03\u7528 vm.$mount \u6302\u8f7d\uff0c\u8fd9\u662f mount \u7684\u5f00\u59cb"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'Vue.prototype._init = function (options?: Object) {\n  // ...\u7701\u7565\n  callHook(vm, "created");\n\n  if (vm.$options.el) {\n    vm.$mount(vm.$options.el);\n  }\n};\n')),(0,r.kt)("p",null,"\u5728 created \u4e4b\u540e\uff0c\u5224\u65ad\u662f\u5426\u8bbe\u7f6e\u4e86 el\uff0c\u5982\u679c\u8bbe\u7f6e\u4e86\u6267\u884c mount\uff0c\u8fd9\u91cc\u662f\u6839\u5b9e\u4f8b\u7684\u6302\u8f7d\uff0c\u672c\u6587\u6211\u4eec\u5c31\u4ece\u6839\u5b9e\u4f8b\u7684\u6302\u8f7d\u5f00\u59cb\uff0c\u7ee7\u7eed\u4e86\u89e3\u4e3b\u4f53\u6d41\u7a0b\u3002"),(0,r.kt)("h2",{id:"mount-1"},"$mount"),(0,r.kt)("p",null,"$mount \u662f\u4e00\u4e2a\u5b9e\u4f8b\u65b9\u6cd5\uff0c\u5b9a\u4e49\u5728\u6700\u5916\u5c42\u7684\u5165\u53e3 src/platforms/web/entry-runtime-with-compiler.js\uff0c\u5982\u4e0b"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'const mount = Vue.prototype.$mount;\nVue.prototype.$mount = function (\n  el?: string | Element,\n  hydrating?: boolean\n): Component {\n  el = el && query(el);\n  if (el === document.body || el === document.documentElement) {\n    process.env.NODE_ENV !== "production" &&\n      warn(\n        `Do not mount Vue to <html> or <body> - mount to normal elements instead.`\n      );\n    return this;\n  }\n\n  const options = this.$options;\n  // resolve template/el and convert to render function\n  if (!options.render) {\n    let template = options.template;\n    if (template) {\n      if (typeof template === "string") {\n        if (template.charAt(0) === "#") {\n          template = idToTemplate(template);\n          // ...\n        }\n      } else if (template.nodeType) {\n        template = template.innerHTML;\n      } else {\n        if (process.env.NODE_ENV !== "production") {\n          warn("invalid template option:" + template, this);\n        }\n        return this;\n      }\n    } else if (el) {\n      template = getOuterHTML(el);\n    }\n\n    // template to rener functions\n    if (template) {\n      /* istanbul ignore if */\n      if (process.env.NODE_ENV !== "production" && config.performance && mark) {\n        mark("compile");\n      }\n\n      const { render, staticRenderFns } = compileToFunctions(\n        template,\n        {\n          outputSourceRange: process.env.NODE_ENV !== "production",\n          shouldDecodeNewlines,\n          shouldDecodeNewlinesForHref,\n          delimiters: options.delimiters,\n          comments: options.comments,\n        },\n        this\n      );\n      options.render = render;\n      options.staticRenderFns = staticRenderFns;\n\n      /* istanbul ignore if */\n      if (process.env.NODE_ENV !== "production" && config.performance && mark) {\n        mark("compile end");\n        measure(`vue ${this._name} compile`, "compile", "compile end");\n      }\n    }\n  }\n  return mount.call(this, el, hydrating);\n};\n')),(0,r.kt)("p",null,"\u9996\u5148\u662f\u5224\u65ad\u662f\u5426\u5b58\u5728 el\uff0c\u83b7\u53d6\u5bf9\u5e94\u7684 DOM \u5143\u7d20\uff0c\u8fd9\u662f\u627e\u5230\u6700\u7ec8\u9700\u8981\u63d2\u5165\u7684\u4f4d\u7f6e\u3002"),(0,r.kt)("p",null,"\u5f80\u4e0b\u662f\u83b7\u53d6\u8981\u7f16\u8bd1\u7684\u6a21\u677f\uff0c\u83b7\u53d6\u5230\u6a21\u677f\u4e4b\u540e\uff0c\u901a\u8fc7 compileToFunctions \u8fdb\u884c\u7f16\u8bd1\u5e76\u6700\u7ec8\u8fd4\u56de render \u51fd\u6570\u3002\u51fd\u6570\u6700\u540e\u8c03\u7528\u4e86\u7f13\u5b58\u7684\u5728 ",(0,r.kt)("inlineCode",{parentName:"p"},"src/platforms/web/entry-runtime.js")," \u4e2d\u5b9a\u4e49\u7684$mount\uff0c\u5176\u4ee3\u7801\u5982\u4e0b"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'import { mountComponent } from "core/instance/lifecycle";\n\nVue.prototype.$mount = function (\n  el?: string | Element,\n  hydrating?: boolean\n): Component {\n  el = el && inBrowser ? query(el) : undefined;\n  return mountComponent(this, el, hydrating);\n};\n')),(0,r.kt)("p",null,"mountComponent \u5b9a\u4e49\u5728 ",(0,r.kt)("inlineCode",{parentName:"p"},"src/core/instance/lifecycle.js")," \u6587\u4ef6\uff0c\u8fd9\u662f mount \u8fc7\u7a0b\u7684\u6838\u5fc3\u3002"),(0,r.kt)("h2",{id:"mountcomponent"},"mountComponent"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'export function mountComponent(\n  vm: Component,\n  el: ?Element,\n  hydrating?: boolean\n): Component {\n  vm.$el = el;\n  if (!vm.$options.render) {\n    vm.$options.render = createEmptyVNode;\n    // ...\u5982\u679c\u8bbe\u7f6e\u4e86template dev\u6a21\u5f0f\u4e0b\u62a5\u9519(\u56e0\u4e3a\u8fd9\u662fruntime only)\n  }\n\n  callHook(vm, "beforeMount");\n\n  let updateComponent;\n  /* istanbul ignore if */\n  if (process.env.NODE_ENV !== "production" && config.performance && mark) {\n    updateComponent = () => {\n      // ...\n    };\n  } else {\n    updateComponent = () => {\n      vm._update(vm._render(), hydrating);\n    };\n  }\n\n  // we set this to vm._watcher inside the watcher\'s constructor\n  // since the watcher\'s initial patch may call $forceUpdate (e.g. inside child\n  // component\'s mounted hook), which relies on vm._watcher being already defined\n  new Watcher(\n    vm,\n    updateComponent,\n    noop,\n    {\n      before() {\n        if (vm._isMounted && !vm._isDestroyed) {\n          callHook(vm, "beforeUpdate");\n        }\n      },\n    },\n    true /* isRenderWatcher */\n  );\n  hydrating = false;\n\n  // manually mounted instance, call mounted on self\n  // mounted is called for render-created child components in its inserted hook\n  if (vm.$vnode == null) {\n    vm._isMounted = true;\n    callHook(vm, "mounted");\n  }\n  return vm;\n}\n')),(0,r.kt)("p",null,"\u5728\u8fd9\u4e2a\u51fd\u6570\u91cc\u9762\u8c03\u7528\u4e86 ",(0,r.kt)("inlineCode",{parentName:"p"},"beforeMount")," \u548c ",(0,r.kt)("inlineCode",{parentName:"p"},"mounted")," \u4e24\u4e2a\u94a9\u5b50\uff0c\u90a3\u4e48\u5728\u8fd9\u91cc\uff0c\u6211\u4eec\u9700\u8981\u56de\u7b54\u4ee5\u4e0b\u4e24\u4e2a\u95ee\u9898"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u4ece created \u5230 beforeMount \u505a\u4e86\u4ec0\u4e48\uff1f"),(0,r.kt)("li",{parentName:"ul"},"\u4ece beforeMount \u5230 mounted \u505a\u4e86\u4ec0\u4e48\uff1f")),(0,r.kt)("h2",{id:"created---beforemount"},"created -> beforeMount"),(0,r.kt)("p",null,"\u505a\u4e86\u4e24\u4ef6\u4e8b\u60c5"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u901a\u8fc7 el \u67e5\u627e\u5230\u8981\u63d2\u5165\u7684\u4f4d\u7f6e"),(0,r.kt)("li",{parentName:"ul"},"template \u8f6c\u6362\u4e3a render \u51fd\u6570")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"created")," \u662f\u521b\u5efa\u5b8c\u6210\uff0c\u800c ",(0,r.kt)("inlineCode",{parentName:"p"},"beforeMount")," \u5219\u8868\u793a\u7684\u662f\u6211\u786e\u8ba4\u4e86\u6709\u6211\u7684\u4f4d\u7f6e\uff0c\u4e5f\u51c6\u5907\u597d\u4e86 render \u51fd\u6570\u3002"),(0,r.kt)("p",null,"\u5f53\u7136\uff0c\u8fd9\u91cc\u7684 \u201c\u51c6\u5907\u597d\u4e86\u201d \u5b9e\u9645\u4e0a\u8fd8\u5dee\u5f88\u591a\uff0c\u5e76\u4e0d\u662f\u50cf\u6211\u4eec\u7528\u76f4\u63a5\u6dfb\u52a0 DOM \u5143\u7d20\u65f6\uff0c\u65b0\u5143\u7d20\u4ec0\u4e48\u90fd\u8bbe\u7f6e\u597d\u4e86\u53ea\u5dee appendChild \u90a3\u79cd \u201d\u51c6\u5907\u597d\u4e86\u201c\u3002"),(0,r.kt)("h2",{id:"beforemount---mounted"},"beforeMount -> mounted"),(0,r.kt)("p",null,"\u5728 mountComponent \u8bbe\u7f6e\u4e86 vm.$el\u4fdd\u5b58\u4e86\u5bf9\u76ee\u6807\u4f4d\u7f6e\u7684\u5f15\u7528\uff0c\u8981\u771f\u6b63\u5c06\u751f\u6210\u7684 DOM \u5143\u7d20\u63d2\u5165\u5230\u9875\u9762\uff0c\u90a3\u4e48\u4f1a\u6709\u5bf9vm.$el \u8fdb\u884c RHS \u7684\u5730\u65b9\uff0c\u5728\u8fd9\u4e2a\u51fd\u6570\u4e2d\u6211\u4eec\u5e76\u6ca1\u6709\u770b\u5230\u3002"),(0,r.kt)("p",null,"\u5728\u6574\u4e2a mountComponent \u51fd\u6570\u4e2d\uff0c\u9664\u4e86 callhook \u5bf9\u8c03\u7528\u94a9\u5b50\u51fd\u6570\u548c new Watcher\uff0c\u5176\u4ed6\u6d89\u53ca\u5230 vm \u7684\u90fd\u53ea\u662f LHS \u67e5\u8be2\uff0c\u90fd\u6ca1\u6709\u7528\u5230 vm.$el\uff0c\u4e5f\u6ca1\u6709\u4e8b\u4ef6\u76d1\u542c\u6216\u8005\u662f\u4ee3\u7406\u62e6\u622a\u4e00\u7c7b\u7684\u3002"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u6211\u4eec\u53ef\u4ee5\u731c\u6d4b\u5f97\u77e5\uff0c\u4e0e\u6302\u8f7d DOM\uff0c\u4e0e\u540e\u9762\u7ec4\u4ef6\u66f4\u65b0\u76f8\u5173\u7684\u903b\u8f91\uff0c\u5c31\u53ea\u80fd\u662f\u5728 new Watcher \u4e2d\u4e86\u3002")),(0,r.kt)("p",null,"\u5728 new Watcher \u4e2d\uff0c\u901a\u8fc7\u5176\u521d\u59cb\u5316\u6240\u4f20\u9012\u7684\u53c2\u6570\uff0c\u53ef\u4ee5\u731c\u6d4b\u5f97\u5230\uff0c\u5176\u4f1a\u8c03\u7528 updateComponent\uff0c\u53bb\u505a\u7b2c\u4e00\u6b21\u7684\u521d\u59cb\u5316\u6e32\u67d3\u3002"),(0,r.kt)("p",null,"\u4e3a\u4e86\u907f\u514d\u6ce8\u610f\u529b\u8fc7\u4e8e\u5206\u6563\uff0c\u5173\u4e8e ",(0,r.kt)("inlineCode",{parentName:"p"},"Watcher")," \u7684\u5185\u5bb9\uff0c\u4e0d\u5728\u8fd9\u91cc\u6df1\u5165\u3002\u76ee\u524d\u53ea\u9700\u8981\u77e5\u9053\uff0c\u8981\u5b9a\u4f4d\u5230\u771f\u6b63 mount \u7684\u5730\u65b9\uff0c\u8981\u4e86\u89e3\u7ec4\u4ef6\u66f4\u65b0\uff0c\u9700\u8981\u4ee5 ",(0,r.kt)("strong",{parentName:"p"},"new Watcher")," \u4f5c\u4e3a\u5207\u5165\u53e3\u3002"),(0,r.kt)("h2",{id:"\u603b\u7ed3"},"\u603b\u7ed3"),(0,r.kt)("p",null,"\u672c\u6587\u53ea\u662f\u6bd4\u8f83\u7b80\u7565\u5730\u8bf4\u660e\u4e86\u4e00\u4e0b mount \u7684\u8fc7\u7a0b\uff0c\u4e86\u89e3\u5230\u7684\u4ece created \u5230 mountComponent \u6240\u505a\u7684\u4e8b\u60c5\u3002"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"created \u5230 beforeMount: el \u6302\u8f7d\u4f4d\u7f6e\u5143\u7d20\u7684\u83b7\u53d6\uff0ctemplate \u8f6c\u6362\u4e3a render \u51fd\u6570"),(0,r.kt)("li",{parentName:"ul"},"beforeMount \u5230 mounted: \u5b9e\u4f8b\u5316 Watcher\uff0c\u901a\u8fc7 Watcher \u8bbe\u7f6e\u54cd\u5e94\u5f0f\u66f4\u65b0\uff0c\u7b2c\u4e00\u6b21\u6e32\u67d3\uff0c\u5e76\u5b9e\u9645\u6302\u8f7d")),(0,r.kt)("p",null,"\u5bf9\u4e8e template \u7f16\u8bd1\u7684\u8fc7\u7a0b\u6211\u4eec\u5c1a\u672a\u6df1\u5165\u7814\u7a76\uff0c\u8fd9\u662f\u7f16\u8bd1\u5668\u76f8\u5173\u7684\u4e8b\u60c5\uff0c\u5355\u72ec\u4e00\u7ae0\u8bf4\u660e\u3002"),(0,r.kt)("p",null,"\u5728\u7f16\u8bd1\u4e4b\u540e\uff0c\u6574\u4e2a\u7684 mount \u8fc7\u7a0b\uff0c\u90fd\u4e0e Watcher \u8fd9\u4e2a\u6784\u9020\u51fd\u6570\u76f8\u5173\uff0c\u8fd9\u662f\u5728\u7f16\u8bd1\u4e4b\u540e\u7ee7\u7eed\u6df1\u5165\u7814\u7a76\u7684\u6700\u91cd\u8981\u7684\u5207\u5165\u70b9\u3002"))}s.isMDXComponent=!0}}]);