"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[7732],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>f});var r=t(7294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,r,i=function(e,n){if(null==e)return{};var t,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var a=r.createContext({}),u=function(e){var n=r.useContext(a),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},c=function(e){var n=u(e.components);return r.createElement(a.Provider,{value:n},e.children)},p="mdxType",m={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},d=r.forwardRef((function(e,n){var t=e.components,i=e.mdxType,o=e.originalType,a=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),p=u(t),d=i,f=p["".concat(a,".").concat(d)]||p[d]||m[d]||o;return t?r.createElement(f,l(l({ref:n},c),{},{components:t})):r.createElement(f,l({ref:n},c))}));function f(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var o=t.length,l=new Array(o);l[0]=d;var s={};for(var a in n)hasOwnProperty.call(n,a)&&(s[a]=n[a]);s.originalType=e,s[p]="string"==typeof e?e:i,l[1]=s;for(var u=2;u<o;u++)l[u]=t[u];return r.createElement.apply(null,l)}return r.createElement.apply(null,t)}d.displayName="MDXCreateElement"},6210:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>m,frontMatter:()=>o,metadata:()=>s,toc:()=>u});var r=t(7462),i=(t(7294),t(3905));const o={},l="\u7f16\u8bd1\u5165\u53e3",s={unversionedId:"frameworks/vue2/overview/entry",id:"frameworks/vue2/overview/entry",title:"\u7f16\u8bd1\u5165\u53e3",description:"\u8bf4\u660e\u5982\u4f55\u901a\u8fc7\u6784\u5efa\u914d\u7f6e\u627e\u5230\u7f16\u8bd1\u5165\u53e3\uff0c\u5e76\u5bf9\u5165\u53e3\u5c42\u6b21\u7ed3\u6784\u8fdb\u884c\u603b\u7ed3",source:"@site/docs/05-frameworks/02-vue2/01-overview/03-entry.md",sourceDirName:"05-frameworks/02-vue2/01-overview",slug:"/frameworks/vue2/overview/entry",permalink:"/docs/frameworks/vue2/overview/entry",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/05-frameworks/02-vue2/01-overview/03-entry.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{},sidebar:"vue2",previous:{title:"\u76ee\u5f55\u7ed3\u6784",permalink:"/docs/frameworks/vue2/overview/dir"},next:{title:"\u6784\u9020\u51fd\u6570",permalink:"/docs/frameworks/vue2/overview/constructor"}},a={},u=[{value:"\u67e5\u627e\u5165\u53e3",id:"\u67e5\u627e\u5165\u53e3",level:2},{value:"\u7531\u5916\u5411\u91cc",id:"\u7531\u5916\u5411\u91cc",level:2},{value:"1. src/platforms/web/entry-runtime-with-compiler.js",id:"1-srcplatformswebentry-runtime-with-compilerjs",level:3},{value:"2. src/platforms/web/entry-runtime.js",id:"2-srcplatformswebentry-runtimejs",level:3},{value:"3. src/core/index.js",id:"3-srccoreindexjs",level:3},{value:"4. src/core/instance/index.js",id:"4-srccoreinstanceindexjs",level:3},{value:"\u7531\u91cc\u5411\u5916",id:"\u7531\u91cc\u5411\u5916",level:2},{value:"1. instance-entry",id:"1-instance-entry",level:3},{value:"2. core-entry",id:"2-core-entry",level:3},{value:"3. runtime-entry",id:"3-runtime-entry",level:3},{value:"4. compiler-entry",id:"4-compiler-entry",level:4},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:3}],c={toc:u},p="wrapper";function m(e){let{components:n,...t}=e;return(0,i.kt)(p,(0,r.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"\u7f16\u8bd1\u5165\u53e3"},"\u7f16\u8bd1\u5165\u53e3"),(0,i.kt)("p",null,"\u8bf4\u660e\u5982\u4f55\u901a\u8fc7\u6784\u5efa\u914d\u7f6e\u627e\u5230\u7f16\u8bd1\u5165\u53e3\uff0c\u5e76\u5bf9\u5165\u53e3\u5c42\u6b21\u7ed3\u6784\u8fdb\u884c\u603b\u7ed3"),(0,i.kt)("h2",{id:"\u67e5\u627e\u5165\u53e3"},"\u67e5\u627e\u5165\u53e3"),(0,i.kt)("p",null,"\u67e5\u770b package.json \u6587\u4ef6\uff0c\u6709\u4ee5\u4e0b\u5185\u5bb9"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'"scripts": {\n  "build": "node scripts/build.js",\n  "release": "bash scripts/release.sh",\n}\n')),(0,i.kt)("p",null,"\u6839\u636e release \u547d\u4ee4\uff0c\u67e5\u770b scripts/release.sh\uff0c\u5176\u529f\u80fd\u662f build and update packages\uff0c\u5176\u4e2d\u6709\u4e00\u6761\u547d\u4ee4\u5982\u4e0b"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"VERSION=$VERSION npm run build\n")),(0,i.kt)("p",null,"\u8fd9\u662f\u6784\u5efa\u547d\u4ee4\uff0c\u8fdb\u4e00\u6b65\u67e5\u770b build \u547d\u4ee4\u5bf9\u5e94\u7684\u811a\u672c scripts/build.js"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'let builds = require("./config").getAllBuilds();\n\n// filter builds via command line arg\nif (process.argv[2]) {\n  const filters = process.argv[2].split(",");\n  builds = builds.filter((b) => {\n    return filters.some(\n      (f) => b.output.file.indexOf(f) > -1 || b._name.indexOf(f) > -1\n    );\n  });\n} else {\n  // filter out weex builds by default\n  builds = builds.filter((b) => {\n    return b.output.file.indexOf("weex") === -1;\n  });\n}\n\nbuild(builds);\n\nfunction build(builds) {\n  let built = 0;\n  const total = builds.length;\n  const next = () => {\n    buildEntry(builds[built])\n      .then(() => {\n        built++;\n        if (built < total) {\n          next();\n        }\n      })\n      .catch(logError);\n  };\n\n  next();\n}\n')),(0,i.kt)("p",null,"\u5176\u4e2d\u6307\u5b9a\u4e86\u5165\u53e3\u5728 scripts/config.js \u91cc\u9762\uff0c\u67e5\u770b\u5185\u5bb9"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'const builds = {\n  // ...\n  // Runtime+compiler CommonJS build (CommonJS)\n  "web-full-cjs-dev": {\n    entry: resolve("web/entry-runtime-with-compiler.js"),\n    dest: resolve("dist/vue.common.dev.js"),\n    format: "cjs",\n    env: "development",\n    alias: { he: "./entity-decoder" },\n    banner,\n  },\n  "web-full-cjs-prod": {\n    entry: resolve("web/entry-runtime-with-compiler.js"),\n    dest: resolve("dist/vue.common.prod.js"),\n    format: "cjs",\n    env: "production",\n    alias: { he: "./entity-decoder" },\n    banner,\n  },\n  // ...\u5176\u4ed6\u5165\u53e3\u914d\u7f6e\n};\n')),(0,i.kt)("p",null,"\u5b66\u4e60\u65f6\u9009\u62e9 ",(0,i.kt)("inlineCode",{parentName:"p"},"src/platforms/web/entry-runtime-with-compiler.js")," \u5207\u5165\u5373\u53ef\uff0c\u5177\u4f53\u5dee\u522b\u5b98\u7f51 ",(0,i.kt)("a",{parentName:"p",href:"https://v2.cn.vuejs.org/v2/guide/installation.html#%E8%BF%90%E8%A1%8C%E6%97%B6-%E7%BC%96%E8%AF%91%E5%99%A8-vs-%E5%8F%AA%E5%8C%85%E5%90%AB%E8%BF%90%E8%A1%8C%E6%97%B6"},"\u8fd9\u91cc")," \u6709\u8be6\u7ec6\u8bf4\u660e\uff0c\u4e0d\u518d\u8d58\u8ff0\u3002"),(0,i.kt)("h2",{id:"\u7531\u5916\u5411\u91cc"},"\u7531\u5916\u5411\u91cc"),(0,i.kt)("p",null,"\u4ece\u7f16\u8bd1\u5165\u53e3 src/platforms/web/entry-runtime-with-compiler.js \u5f00\u59cb\uff0c\u5b9a\u4f4d Vue \u6784\u9020\u51fd\u6570"),(0,i.kt)("h3",{id:"1-srcplatformswebentry-runtime-with-compilerjs"},"1. src/platforms/web/entry-runtime-with-compiler.js"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'import Vue from "./runtime/index";\n// ...\u7701\u7565\u4e2d\u95f4\u7684\u62d3\u5c55\n\nexport default Vue;\n')),(0,i.kt)("h3",{id:"2-srcplatformswebentry-runtimejs"},"2. src/platforms/web/entry-runtime.js"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'import Vue from "core/index";\n// ...\u7701\u7565\u4e2d\u95f4\u7684\u62d3\u5c55\n\nexport default Vue;\n')),(0,i.kt)("h3",{id:"3-srccoreindexjs"},"3. src/core/index.js"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'import Vue from "./instance/index";\n// ...\u7701\u7565\u4e2d\u95f4\u7684\u62d3\u5c55\n\nexport default Vue;\n')),(0,i.kt)("h3",{id:"4-srccoreinstanceindexjs"},"4. src/core/instance/index.js"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'import { initMixin } from "./init";\nimport { stateMixin } from "./state";\nimport { renderMixin } from "./render";\nimport { eventsMixin } from "./events";\nimport { lifecycleMixin } from "./lifecycle";\nimport { warn } from "../util/index";\n\nfunction Vue(options) {\n  if (process.env.NODE_ENV !== "production" && !(this instanceof Vue)) {\n    warn("Vue is a constructor and should be called with the `new` keyword");\n  }\n  this._init(options);\n}\n\ninitMixin(Vue);\nstateMixin(Vue);\neventsMixin(Vue);\nlifecycleMixin(Vue);\nrenderMixin(Vue);\n\nexport default Vue;\n')),(0,i.kt)("p",null,"\u8fd9\u4e2a instance/index.js \u662f\u6784\u9020\u51fd\u6570\u5b9a\u4e49\u7684\u5730\u65b9\uff0c\u4ece\u6700\u5916\u5c42\u7684\u5165\u53e3\u5230\u8fd9\u91cc\u603b\u5171\u6709 4 \u4e2a\u5c42\u7ea7\uff0c\u6211\u79f0\u4e4b\u4e3a"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"compiler-entry"),(0,i.kt)("li",{parentName:"ul"},"runtime-entry"),(0,i.kt)("li",{parentName:"ul"},"core-entry"),(0,i.kt)("li",{parentName:"ul"},"instance-entry")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"\u6bcf\u4e2a\u5c42\u7ea7\u505a\u4e86\u4ec0\u4e48\u5462\uff1f")),(0,i.kt)("p",null,"\u4e3a\u4e86\u56de\u7b54\u8fd9\u4e2a\u95ee\u9898\uff0c\u4ece\u91cc\u5411\u5916\u53cd\u8fc7\u6765\u53bb\u770b\uff0c\u8fd9\u6837\u5173\u6ce8\u70b9\u7531\u5c11\u5230\u591a\uff0c\u53bb\u770b\u6bcf\u4e00\u5c42\u52a0\u4e86\u4ec0\u4e48\u5185\u5bb9\u3002"),(0,i.kt)("h2",{id:"\u7531\u91cc\u5411\u5916"},"\u7531\u91cc\u5411\u5916"),(0,i.kt)("p",null,"\u4ece\u91cc\u5411\u5916\u770b\u6bcf\u4e00\u5c42\u505a\u4e86\u4ec0\u4e48"),(0,i.kt)("h3",{id:"1-instance-entry"},"1. instance-entry"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'import { initMixin } from "./init";\nimport { stateMixin } from "./state";\nimport { renderMixin } from "./render";\nimport { eventsMixin } from "./events";\nimport { lifecycleMixin } from "./lifecycle";\nimport { warn } from "../util/index";\n\nfunction Vue(options) {\n  if (process.env.NODE_ENV !== "production" && !(this instanceof Vue)) {\n    warn("Vue is a constructor and should be called with the `new` keyword");\n  }\n  this._init(options);\n}\n\ninitMixin(Vue);\nstateMixin(Vue);\neventsMixin(Vue);\nlifecycleMixin(Vue);\nrenderMixin(Vue);\n\nexport default Vue;\n')),(0,i.kt)("p",null,"instance \u662f \u5b9e\u4f8b \u7684\u610f\u601d\uff0c\u547d\u540d\u4e0a\u4f53\u73b0\u4e86\u5b83\u7684\u4f5c\u7528\uff0c\u5373\u751f\u6210\u5b9e\u4f8b\uff0c\u6216\u8005\u8bf4\u6784\u9020\u51fd\u6570\u3002"),(0,i.kt)("p",null,"\u6839\u636e\u5b9a\u4e49\u6784\u9020\u51fd\u6570\u7684\u65b9\u5f0f\uff0c\u6211\u4eec\u53ef\u4ee5\u731c\u6d4b\u5230\uff0c\u4e0b\u9762\u7684\u4e00\u5806 mixin \u505a\u7684\u4e8b\u60c5\uff0c\u65e0\u975e\u662f\u5b9a\u4e49\u9759\u6001\u53d8\u91cf\u3001\u65b9\u6cd5\u6216\u8005\u662f\u62d3\u5c55 prototype\uff0c\u5982\u5b9e\u4f8b\u5316\u8fc7\u7a0b\u4e2d\u8c03\u7528\u7684","_","init\uff0c\u663e\u7136\u5c31\u662f\u5b9a\u4e49\u5230\u539f\u578b\u4e0a\u7684\u3002"),(0,i.kt)("h3",{id:"2-core-entry"},"2. core-entry"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'import Vue from "./instance/index";\nimport { initGlobalAPI } from "./global-api/index";\nimport { isServerRendering } from "core/util/env";\nimport { FunctionalRenderContext } from "core/vdom/create-functional-component";\n\ninitGlobalAPI(Vue);\n\n// \u5224\u65ad\u7684\u662f vue-server-renderer \u91cc\u9762\u8bbe\u7f6e\u7684 VUE_ENV = \'server\'\nObject.defineProperty(Vue.prototype, "$isServer", {\n  get: isServerRendering,\n});\n\nObject.defineProperty(Vue.prototype, "$ssrContext", {\n  get() {\n    /* istanbul ignore next */\n    return this.$vnode && this.$vnode.ssrContext;\n  },\n});\n\n// expose FunctionalRenderContext for ssr runtime helper installation\nObject.defineProperty(Vue, "FunctionalRenderContext", {\n  value: FunctionalRenderContext,\n});\n\nVue.version = "__VERSION__";\n\nexport default Vue;\n')),(0,i.kt)("p",null,"\u521d\u59cb\u5316\u4e86\u5168\u5c40 API\uff0c\u5b9a\u4e49$isServer\u6807\u8bb0\u548c$ssrContext \u4e0a\u4e0b\u6587\u3002\u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u4e00\u5c42\u662f Vue \u6784\u9020\u51fd\u6570\u672c\u8eab\u7684\u5c5e\u6027\u62d3\u5c55\uff0c\u662f\u201c\u8de8\u7aef\u201d\u76f8\u5173\u7684\u8bbe\u7f6e\u3002"),(0,i.kt)("h3",{id:"3-runtime-entry"},"3. runtime-entry"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'import Vue from "core/index";\n\n// ...\nVue.prototype.__patch__ = inBrowser ? patch : noop;\n\nVue.prototype.$mount = function (\n  el?: string | Element,\n  hydrating?: boolean\n): Component {\n  el = el && inBrowser ? query(el) : undefined;\n  return mountComponent(this, el, hydrating);\n};\n')),(0,i.kt)("p",null,"\u5bf9\u4e8e weex\uff0centry-runtime \u5728\u662f\u53e6\u4e00\u4e2a\u6587\u4ef6 src/platforms/weex/runtime/index.js\uff0c\u5e73\u53f0\u7684\u533a\u5206\u5728\u6587\u4ef6\u4e0a\u5c31\u5df2\u7ecf\u5206\u5f00\u4e86\u3002\u5bf9\u4e8e src/platforms/web/runtime/index.js\uff0c\u5b83\u662f\u9488\u5bf9 web \u7684\uff0c\u5728\u8fd9\u4e2a\u524d\u63d0\u4e0b\uff0c\u5b83\u662f\u8fd0\u884c\u73af\u5883\u662f client \u8fd8\u662f server \u7684\u5dee\u5f02\u5904\u7406\u3002"),(0,i.kt)("h4",{id:"4-compiler-entry"},"4. compiler-entry"),(0,i.kt)("p",null,"\u7b80\u5316\u540e\u63cf\u8ff0\u5982\u4e0b"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"const mount = Vue.prototype.$mount\nVue.prototype.$mount = function (\n  el?: string | Element,\n  hydrating?: boolean\n): Component {\n  if (el === document.body || el === document.documentElement) {\n    // ...dev\u72b6\u6001\u4e0b\u63d0\u793a\n  }\n\n  const options = this.$options\n  if (!options.render) {\n    template = resolveTempate(); // 1. resolve template/el\n\n    if (template) {\n      const { render, staticRenderFns } = compileToFunctions((template, {\n        // ...\u4e00\u5806\u53c2\u6570\n      }, this) // 2. convert to render function\n    }\n    options.render = render\n    options.staticRenderFns = staticRenderFns\n  }\n}\n")),(0,i.kt)("p",null,"\u5148\u83b7\u53d6\u5230 template\uff0c\u7136\u540e\u8c03\u7528 compileToFunctions \u751f\u6210 render \u51fd\u6570\u3002\u5982\u5176\u6587\u4ef6\u547d\u540d\u6240\u793a\uff0c\u662f\u5728 runtime entry \u7684\u57fa\u7840\u4e0a\u52a0\u4e86\u4e00\u4e2a compiler\uff0c\u62e5\u6709\u5728\u8fd0\u884c\u65f6\u5c06 template \u8f6c\u6362\u4e3a render \u65b9\u6cd5\u7684\u7f16\u8bd1\u80fd\u529b\u3002"),(0,i.kt)("h3",{id:"\u603b\u7ed3"},"\u603b\u7ed3"),(0,i.kt)("p",null,"\u672c\u6587\u7b80\u5355\u8bf4\u660e\u4e86 Vue \u6784\u9020\u51fd\u6570\u5b9a\u4e49\uff0c\u5c42\u5c42\u62d3\u5c55\u7684\u5c42\u6b21\u5173\u7cfb\uff0c\u5bf9\u4e8e\u5165\u53e3\u5c42\u6b21\u7ed3\u6784\u6709\u4e00\u4e2a\u76f4\u89c2\u7684\u4e86\u89e3\u3002"),(0,i.kt)("p",null,"\u6bcf\u4e2a\u5c42\u6b21\u7684\u4f5c\u7528\u5982\u4e0b"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"// 1. \u6784\u9020\u51fd\u6570\u5b9a\u4e49\nsrc/core/instance/index.js\n\n// 2. Global API \u53ca SSR \u76f8\u5173\u6807\u8bb0\u4f4d\u3001ctx \u7b49\u5b9a\u4e49\nsrc/core/index.js\n\n// 3. \u4e24\u4e2a\u6587\u4ef6\u4e4b\u95f4\u662f\u5e73\u53f0\u7684\u5dee\u5f02\u5904\u7406\uff0centry-runtime.js \u6587\u4ef6\u5185\u90e8\u662f\u8fd0\u884c\u73af\u5883\u7684\u5904\u7406\nsrc/platforms/web/entry-runtime.js\nsrc/platforms/weex/entry-runtime.js\n\n// 4. \u6a21\u677f\u7f16\u8bd1\u80fd\u529b\nsrc/platforms/web/entry-runtime-with-compiler.js\n")))}m.isMDXComponent=!0}}]);